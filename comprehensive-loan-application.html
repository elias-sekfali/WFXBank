<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <script async="true" language="javascript"
    src="https://cdn.whatfix.com/prod/3a73a2d4-2947-474e-a9f1-2b77a14d9f68/initiator/initiator.nocache.js"
    type="text/javascript"></script>
  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-TKHL8X8');</script>
  <!-- End Google Tag Manager -->
  <!-- Amazon Connect Tag -->
  <script type="text/javascript">
    (function (w, d, x, id) {
      s = d.createElement('script');
      s.src = 'https://dend6g4sigg57.cloudfront.net/amazon-connect-chat-interface-client.js';
      s.async = 1;
      s.id = id;
      d.getElementsByTagName('head')[0].appendChild(s);
      w[x] = w[x] || function () { (w[x].ac = w[x].ac || []).push(arguments) };
    })(window, document, 'amazon_connect', '747c1c51-d0c3-4b1a-a9e6-446b8070c975');
    amazon_connect('styles', { openChat: { color: 'white', backgroundColor: '#0050b2' }, closeChat: { color: 'white', backgroundColor: '#0050b2' } });
    amazon_connect('supportedMessagingContentTypes', ['text/plain', 'text/markdown']);
  </script>
  <!-- End Amazon Connect Tag -->
  <meta content="noindex" name="robots" />
  <meta charset="utf-8" />
  <meta content="ie=edge" http-equiv="x-ua-compatible" />
  <meta content="width=device-width,initial-scale=1.0" name="viewport" />
  <title>Comprehensive Loan Application - Whatfix Bank</title>
  <link rel="icon" type="image/png" href="img/favicon.png" />
  <!-- CSS here -->
  <link href="css/bootstrap.min.css" media="all" rel="stylesheet" type="text/css">
  <link href="css/elegant-icons.min.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/all.min.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/animate.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/nice-select.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/default.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/style.css" media="all" rel="stylesheet" type="text/css" />
  <link href="css/responsive.css" media="all" rel="stylesheet" type="text/css" />
  <style>
    .progress-bar-container {
      background: #e9ecef;
      border-radius: 5px;
      height: 10px;
      margin: 20px 0;
    }
    .progress-bar-fill {
      background: linear-gradient(to right, #0050b2, #007bff);
      height: 100%;
      border-radius: 5px;
      transition: width 0.3s ease;
    }
    .section-divider {
      border-top: 2px solid #e9ecef;
      margin: 40px 0;
      position: relative;
    }
    .section-divider::before {
      content: '';
      position: absolute;
      top: -1px;
      left: 0;
      width: 50px;
      height: 2px;
      background: #0050b2;
    }
    .form-step {
      margin-bottom: 50px;
    }
    .form-step h3 {
      color: #0050b2;
      margin-bottom: 25px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e9ecef;
    }
    .required-field::after {
      content: " *";
      color: #dc3545;
    }
    .kyc-notice {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      padding: 15px;
      margin: 20px 0;
    }
    .kyc-notice h5 {
      color: #0050b2;
      margin-bottom: 10px;
    }
    .file-upload-area {
      border: 2px dashed #dee2e6;
      border-radius: 5px;
      padding: 30px;
      text-align: center;
      transition: border-color 0.3s ease;
    }
    .file-upload-area:hover {
      border-color: #0050b2;
    }
    .file-upload-area.dragover {
      border-color: #007bff;
      background-color: #f8f9fa;
    }
    .uploaded-files {
      margin-top: 15px;
    }
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    .risk-assessment {
      background: #e7f3ff;
      border: 1px solid #0050b2;
      border-radius: 5px;
      padding: 20px;
      margin: 20px 0;
    }
    /* Custom dropdown styling */
    .custom-dropdown {
      position: relative;
      display: block;
      width: 100%;
    }
    .custom-dropdown-selected {
      background: white;
      border: 1px solid #ced4da;
      border-radius: 0.375rem;
      padding: 0.375rem 0.75rem;
      font-size: 1rem;
      line-height: 1.5;
      color: #495057;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    .custom-dropdown-selected:hover,
    .custom-dropdown-selected:focus {
      border-color: #0050b2;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(0, 80, 178, 0.25);
    }
    .custom-dropdown-selected.placeholder {
      color: #6c757d;
    }
    .custom-dropdown-arrow {
      transition: transform 0.3s ease;
    }
    .custom-dropdown.open .custom-dropdown-arrow {
      transform: rotate(180deg);
    }
    .custom-dropdown-options {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ced4da;
      border-top: none;
      border-radius: 0 0 0.375rem 0.375rem;
      max-height: 200px;
      overflow-y: auto;
      z-index: 9999;
      display: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    /* Ensure loan-specific dropdowns work properly */
    .loan-specific-section .custom-dropdown {
      position: relative;
      z-index: 1;
    }
    .loan-specific-section .custom-dropdown.open .custom-dropdown-options {
      z-index: 9999;
    }
    
    /* Ensure navigation buttons stay below dropdowns */
    .nav-buttons {
      position: relative;
      z-index: 1;
    }
    .nav-btn .btn {
      position: relative;
      z-index: 1;
    }
    .custom-dropdown.open .custom-dropdown-options {
      display: block;
      z-index: 9999 !important;
    }
    
    /* Ensure open dropdowns are always on top */
    .custom-dropdown.open {
      z-index: 9998;
    }
    .custom-dropdown-option {
      padding: 0.5rem 0.75rem;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }
    .custom-dropdown-option:hover {
      background-color: #f8f9fa;
    }
    .custom-dropdown-option.selected {
      background-color: #0050b2;
      color: white;
    }
    
    /* Ensure dropdowns are clickable and properly sized */
    .custom-dropdown {
      min-height: 38px;
      position: relative;
    }
    .custom-dropdown-selected {
      min-height: 36px;
      cursor: pointer;
      user-select: none;
      position: relative;
      z-index: 1;
    }
    .custom-dropdown-option {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      position: relative;
      z-index: 1;
    }
    
    /* Prevent other elements from overlapping dropdowns */
    .form-step {
      position: relative;
    }
    .loan-details-widget {
      position: relative;
      overflow: visible;
    }
    
    /* Address template styling */
    .address-template-selector {
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 5px;
      border: 1px solid #dee2e6;
    }
    .address-template-option {
      margin-bottom: 10px;
    }
    .address-template-option:last-child {
      margin-bottom: 0;
    }
    .address-preview {
      margin-top: 10px;
      padding: 10px;
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 3px;
      font-size: 0.9rem;
      color: #6c757d;
    }
    .address-fields.manual-entry {
      display: block;
    }
    .address-fields.template-selected {
      display: none;
    }
    .form-step {
      display: none;
    }
    .form-step.active {
      display: block;
    }
    /* Signature pad styling */
    .signature-pad-container {
      max-width: 100%;
      margin: 0 auto;
    }
    .canvas-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      min-height: 200px;
    }
    #signaturePad {
      width: 100%;
      height: 200px;
      min-height: 200px;
      touch-action: none;
      display: block;
      margin: 0;
      padding: 0;
      border: 2px solid #dee2e6;
      border-radius: 5px;
      background: white;
      cursor: crosshair;
      box-sizing: border-box;
    }
    
    /* Mobile signature pad adjustments */
    @media (max-width: 768px) {
      .canvas-container {
        max-width: 100%;
        min-height: 150px;
      }
      #signaturePad {
        height: 150px;
        min-height: 150px;
      }
    }
    .signature-options .btn-group {
      width: 100%;
      display: flex;
    }
    .signature-options .btn {
      flex: 1;
      margin: 0 2px;
    }
    .loan-specific-section {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Mobile improvements */
    @media (max-width: 768px) {
      .form-step h3 {
        font-size: 1.5rem;
        margin-bottom: 20px;
      }
      .signature-options .btn {
        font-size: 0.9rem;
        padding: 8px 12px;
      }
      #signaturePad {
        height: 150px;
      }
      .stepper-widget {
        margin-bottom: 30px;
      }
      .loan-details-widget {
        padding: 20px;
      }
      .nav-btn {
        flex-direction: column;
        gap: 10px;
      }
      .nav-btn .btn {
        width: 100%;
        margin: 5px 0;
      }
    }
    
    /* Error message styling */
    .error-message {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      display: none;
    }
    .error-message.show {
      display: block;
    }
  </style>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-TKHL8X8"
      style="display:none;visibility:hidden" width="0"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  
  <!-- Header -->
  <header class="header" wfx_id="header-element-component-k">
    <div class="header-top py-2 bg_white" wfx_id="header-element-top-bar">
      <div class="container" wfx_id="header-container-top-section">
        <div class="row align-items-center" wfx_id="header-element-component-l">
          <div class="col-md-5" wfx_id="header-element-component-l-c">
            <div class="header-info-left" wfx_id="header-element-component-l-d">
              <div class="timestamp" wfx_id="header-element-business-hours"> <i class="icon_clock_alt"></i> Mon - Fri 10:00-18:00</div>
            </div>
          </div>
          <div class="col-md-7" wfx_id="header-element-component-n">
            <div class="header-info-right" wfx_id="header-element-component-n-f">
              <ul wfx_id="header-container-navigation-main-navbar">
                <li wfx_id="header-element-component-n-g">
                  <img alt="phone" class="img-fluid" src="img/phone-outline-white.png" wfx_id="header-element-phone-contact-icon" />
                  <a href="tel:01234567890" wfx_id="header-element-phone-contact-wrapper">+44 330 054 3073</a>
                </li>
                <li wfx_id="header-element-component-p">
                  <i class="icon_mail_alt"></i><a href="mailto:info@whatfixbank.com" wfx_id="header-element-email-contact">info@whatfixbank.com</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="header-menu header-menu-3" id="sticky" wfx_id="header-element-main-menu">
      <nav class="navbar navbar-expand-lg" wfx_id="header-element-navigation-bar-q">
        <div class="container" wfx_id="header-container-navigation-main-navbar-b">
          <a class="navbar-brand sticky_logo" href="index.html" wfx_id="header-logo-sticky-nav-brand">
            <img alt="logo" class="main" src="img/logo/Logo.png" srcset="img/logo/Logo@2x.png 2x" wfx_id="header-logo-main" />
            <img alt="logo" class="sticky" src="img/logo/Logo-2.png" srcset="img/logo/Logo-2@2x.png 2x" wfx_id="header-logo-sticky-nav-image" />
          </a>
          
          <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
            class="navbar-toggler collapsed" data-bs-target="#navbarSupportedContent" data-bs-toggle="collapse"
            type="button" wfx_id="header-element-navigation-bar-s">
            <span class="menu_toggle">
              <span class="hamburger">
                <span></span>
                <span></span>
                <span></span>
              </span>
              <span class="hamburger-cross">
                <span></span>
                <span></span>
              </span>
            </span>
          </button>
          
          <div class="collapse navbar-collapse" id="navbarSupportedContent" wfx_id="header-element-navigation-bar-t">
            <ul class="navbar-nav menu ms-auto" wfx_id="header-element-navigation-bar-t-d">
              <li class="nav-item dropdown submenu" wfx_id="nav-menu-item-bank-dropdown-u">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                  href="#" role="button" wfx_id="nav-menu-link-bank">Bank</a>
                <i aria-hidden="true" class="arrow_carrot-down_alt2 mobile_dropdown_icon" data-bs-toggle="dropdown"></i>
                <ul class="dropdown-menu" wfx_id="nav-submenu-bank-options">
                  <li class="nav-item" wfx_id="nav-menu-item-bank-dropdown-v"><a class="nav-link" href="index.html"
                      wfx_id="nav-menu-link-current-accounts-v">Current Accounts</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-bank-dropdown-v-c"><a class="nav-link" href="index.html"
                      wfx_id="nav-menu-link-current-accounts-w">Premier Current Account</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-bank-dropdown-w"><a class="nav-link" href="index.html"
                      wfx_id="nav-menu-link-student">Student Account</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-bank-dropdown-x"><a class="nav-link" href="index.html"
                      wfx_id="nav-menu-link-switch">Make the Switch</a>
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown submenu" wfx_id="nav-menu-item-bank-dropdown-x-f">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                  href="#" role="button" wfx_id="nav-menu-link-borrow">Borrow</a>
                <i aria-hidden="true" class="arrow_carrot-down_alt2 mobile_dropdown_icon" data-bs-toggle="dropdown"></i>
                <ul class="dropdown-menu" wfx_id="nav-submenu-borrow-options">
                  <li class="nav-item" wfx_id="nav-menu-item-borrow-dropdown-y"><a class="nav-link"
                      href="loan-details.html" wfx_id="nav-menu-link-personal-loan">Personal Loan</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-borrow-dropdown-z"><a class="nav-link" href="index-2.html"
                      wfx_id="nav-menu-link-car-loan">Car Loan</a>
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown submenu" wfx_id="nav-menu-item-borrow-dropdown-a">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                  href="#" role="button" wfx_id="nav-menu-link-cards-dropdown-trigger">Cards</a>
                <i aria-hidden="true" class="arrow_carrot-down_alt2 mobile_dropdown_icon" data-bs-toggle="dropdown"></i>
                <ul class="dropdown-menu" wfx_id="nav-submenu-cards-options-b">
                  <li class="nav-item" wfx_id="nav-menu-item-cards-dropdown-credit-card"><a class="nav-link"
                      href="index.html" wfx_id="nav-menu-link-cards-credit-option">Credit Card</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-cards-dropdown-credit-card-b"><a class="nav-link"
                      href="index-2.html" wfx_id="nav-menu-link-cards-credit-option-c">Premier Credit Card</a>
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown submenu" wfx_id="nav-menu-item-cards-dropdown-credit-card-c">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                  href="#" role="button" wfx_id="nav-menu-link-savings">Savings</a>
                <i aria-hidden="true" class="arrow_carrot-down_alt2 mobile_dropdown_icon" data-bs-toggle="dropdown"></i>
                <ul class="dropdown-menu" wfx_id="nav-submenu-cards-options-d">
                  <li class="nav-item" wfx_id="nav-menu-item-cards-dropdown-cards"><a class="nav-link" href="index.html"
                      wfx_id="nav-menu-link-isa">Cash and Stock ISA</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-cards-dropdown-cards-e"><a class="nav-link"
                      href="index-2.html" wfx_id="nav-menu-link-funds">Fund Plans</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-cards-dropdown-cards-f"><a class="nav-link"
                      href="index-2.html" wfx_id="nav-menu-link-investment">Investment Advice</a>
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown submenu" wfx_id="nav-menu-item-savings-dropdown">
                <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"
                  href="." role="button" wfx_id="nav-menu-link-mortgages-g">
                  Mortgage
                </a>
                <i aria-hidden="false" class="arrow_carrot-down_alt2 mobile_dropdown_icon"
                  data-bs-toggle="dropdown"></i>
                <ul class="dropdown-menu" wfx_id="nav-submenu-mortgages-options-g">
                  <li class="nav-item" wfx_id="nav-menu-item-mortgages-dropdown-h"><a class="nav-link" href="loan.html"
                      wfx_id="nav-menu-link-mortgages-h">First Time Buyer</a></li>
                  <li class="nav-item" wfx_id="nav-menu-item-mortgages-dropdown-h-b"><a aria-expanded="false"
                      aria-haspopup="true" class="nav-link" data-bs-toggle="dropdown" href="#" role="button"
                      wfx_id="nav-menu-link-mortgages-i">Remortgage</a>
                  </li>
                  <li class="nav-item" wfx_id="nav-menu-item-mortgages-dropdown-i"><a class="nav-link" href="loan.html"
                      wfx_id="nav-menu-link-mortgages-i-d">Mortgage Rates</a></li>
                </ul>
              </li>
            </ul>
            <a class="theme-btn" href="login.html" wfx_id="header-login-button">Log In</a>
          </div>
        </div>
      </nav>
    </div>
  </header>
  <!-- Header end-->

  <main wfx_id="page-main-content">
    <!-- BreadCrumb start -->
    <section class="breadcrumb-area" wfx_id="header-element-component-m">
      <div class="breadcrumb-widget pt-200 pb-110" style="background-image: url(img/loan-apply-banner.png);" wfx_id="header-element-component-m-j">
        <div class="container" wfx_id="header-container-wrapper">
          <div class="row" wfx_id="header-element-component-n-k">
            <div class="col-md-12" wfx_id="header-element-component-n-l">
              <div class="breadcrumb-content pt-85" wfx_id="header-element-component-n-m">
                <h1>Comprehensive Loan Application</h1>
                <ul wfx_id="hero-container-loan">
                  <li wfx_id="hero-element-loan-n"><a href="index.html" wfx_id="hero-element-loan-o">home</a></li>
                  <li wfx_id="hero-element-loan-o-c"><a href="index.html" wfx_id="hero-element-loan-o-d">borrow</a></li>
                  <li wfx_id="loan-process-step-workflow-o">loan application</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- BreadCrumb end -->

    <!-- Application Progress -->
    <section class="pt-50 pb-20">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="progress-bar-container">
              <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="text-center">
              <small class="text-muted">Step <span id="currentStepText">1</span> of 5 - Application Progress: <span id="progressText">20%</span></small>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- KYC Notice -->
    <section class="pt-20 pb-20">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="kyc-notice">
              <h5><i class="fas fa-shield-alt"></i> Know Your Customer (KYC) Compliance</h5>
              <p>This application follows industry-standard KYC procedures to ensure regulatory compliance and prevent financial crimes. All information provided will be verified through our secure systems.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Application Form -->
    <section class="loan-details-area bg_disable pt-50 pb-120">
      <div class="container">
        <div class="row">
          <div class="col-lg-3">
            <div class="stepper-widget mt-sm-5 px-3 px-sm-0" wfx_id="loan-process-step-navigation">
              <ul wfx_id="loan-process-step-workflow">
                <li class="active mt-0" id="step1-nav" wfx_id="loan-process-step-current">
                  <a href="#" onclick="showStep(1)">
                    <div class="number"><i class="icon_check"></i><span>1</span></div>
                    Loan Details
                  </a>
                </li>
                <li id="step2-nav">
                  <a href="#" onclick="showStep(2)">
                    <div class="number"><i class="icon_check"></i><span>2</span></div>
                    Personal & Address
                  </a>
                </li>
                <li id="step3-nav">
                  <a href="#" onclick="showStep(3)">
                    <div class="number"><i class="icon_check"></i><span>3</span></div>
                    Employment & Income
                  </a>
                </li>
                <li id="step4-nav">
                  <a href="#" onclick="showStep(4)">
                    <div class="number"><i class="icon_check"></i><span>4</span></div>
                    Documents Upload
                  </a>
                </li>
                <li id="step5-nav">
                  <a href="#" onclick="showStep(5)">
                    <div class="number"><i class="icon_check"></i><span>5</span></div>
                    Review & Submit
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-9">
            <div class="loan-details-widget bg_white">
              <form id="comprehensiveLoanForm" wfx_id="comprehensive-loan-form">
                
                <!-- Step 1: Loan Details -->
                <div class="form-step active" id="step1">
                  <h3><i class="fas fa-money-bill-wave"></i> Loan Requirements</h3>
                  
                  <!-- Loan Type Selection -->
                  <div class="row mb-35 gy-4">
                    <div class="col-12">
                      <label class="label required-field">Select Loan Type</label>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <input class="select-loan-type-radio" id="Personal_loan" name="select-loan-type" type="radio" required />
                      <label class="loan-type" for="Personal_loan">
                        <img alt="icon" src="img/apply-loan/icon-4.1.png" />
                        <img alt="icon" src="img/apply-loan/icon-4.2.png" />
                        <span>Personal Loan</span>
                      </label>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <input class="select-loan-type-radio" id="Home_loan" name="select-loan-type" type="radio" />
                      <label class="loan-type" for="Home_loan">
                        <img alt="icon" src="img/apply-loan/icon-5.1.png" />
                        <img alt="icon" src="img/apply-loan/icon-5.2.png" />
                        <span>Home Loan</span>
                      </label>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <input class="select-loan-type-radio" id="Business_loan" name="select-loan-type" type="radio" />
                      <label class="loan-type" for="Business_loan">
                        <img alt="icon" src="img/apply-loan/icon-6.1.png" />
                        <img alt="icon" src="img/apply-loan/icon-6.2.png" />
                        <span>Business Loan</span>
                      </label>
                    </div>
                    <div class="col-lg-3 col-md-6">
                      <input class="select-loan-type-radio" id="Car_loan" name="select-loan-type" type="radio" />
                      <label class="loan-type" for="Car_loan">
                        <img alt="icon" src="img/apply-loan/icon-7.1.png" />
                        <img alt="icon" src="img/apply-loan/icon-7.2.png" />
                        <span>Car Loan</span>
                      </label>
                    </div>
                  </div>

                  <!-- Loan Details -->
                  <div class="row gy-4">
                    <div class="col-md-6">
                      <label class="label required-field" for="financingType">Financing Type</label>
                      <div class="custom-dropdown" data-name="financingType" data-required="true">
                        <div class="custom-dropdown-selected placeholder" tabindex="0">
                          <span>Choose financing type</span>
                          <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                        </div>
                        <div class="custom-dropdown-options">
                          <div class="custom-dropdown-option" data-value="Debt-Financing">Debt Financing</div>
                          <div class="custom-dropdown-option" data-value="Equity-Finance">Equity Finance</div>
                          <div class="custom-dropdown-option" data-value="Asset-Based">Asset Based Financing</div>
                          <div class="custom-dropdown-option" data-value="Invoice-Financing">Invoice Financing</div>
                        </div>
                      </div>
                      <input type="hidden" id="financingType" name="financingType" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="bankService">Bank Service</label>
                      <div class="custom-dropdown" data-name="bankService" data-required="true">
                        <div class="custom-dropdown-selected placeholder" tabindex="0">
                          <span>Choose bank service</span>
                          <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                        </div>
                        <div class="custom-dropdown-options">
                          <div class="custom-dropdown-option" data-value="Individual-Banking">Individual Banking</div>
                          <div class="custom-dropdown-option" data-value="Business-Banking">Business Banking</div>
                          <div class="custom-dropdown-option" data-value="Digital-Banking">Digital Banking</div>
                          <div class="custom-dropdown-option" data-value="Premier-Banking">Premier Banking</div>
                        </div>
                      </div>
                      <input type="hidden" id="bankService" name="bankService" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="loanAmount">Loan Amount</label>
                      <div class="input-field">
                        <span>$</span>
                        <input class="form-control" id="loanAmount" name="loanAmount" type="number" min="1000" max="1000000" required />
                      </div>
                      <small class="text-muted">Minimum: $1,000 | Maximum: $1,000,000</small>
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="loanPurpose">Loan Purpose</label>
                      <div class="custom-dropdown" data-name="loanPurpose" data-required="true">
                        <div class="custom-dropdown-selected placeholder" tabindex="0">
                          <span>Select purpose</span>
                          <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                        </div>
                        <div class="custom-dropdown-options">
                          <div class="custom-dropdown-option" data-value="debt-consolidation">Debt Consolidation</div>
                          <div class="custom-dropdown-option" data-value="home-improvement">Home Improvement</div>
                          <div class="custom-dropdown-option" data-value="major-purchase">Major Purchase</div>
                          <div class="custom-dropdown-option" data-value="medical-expenses">Medical Expenses</div>
                          <div class="custom-dropdown-option" data-value="vacation">Vacation</div>
                          <div class="custom-dropdown-option" data-value="wedding">Wedding</div>
                          <div class="custom-dropdown-option" data-value="education">Education</div>
                          <div class="custom-dropdown-option" data-value="business-expansion">Business Expansion</div>
                          <div class="custom-dropdown-option" data-value="other">Other</div>
                        </div>
                      </div>
                      <input type="hidden" id="loanPurpose" name="loanPurpose" required />
                    </div>
                    <div class="col-md-12">
                      <label class="label required-field mb-4">Loan Duration</label>
                      <div class="row">
                        <div class="col-md-2 col-6">
                          <div class="form-check">
                            <input class="form-check-input" id="duration12" name="loanDuration" type="radio" value="12" required />
                            <label class="form-check-label" for="duration12">12 months</label>
                          </div>
                        </div>
                        <div class="col-md-2 col-6">
                          <div class="form-check">
                            <input class="form-check-input" id="duration18" name="loanDuration" type="radio" value="18" />
                            <label class="form-check-label" for="duration18">18 months</label>
                          </div>
                        </div>
                        <div class="col-md-2 col-6">
                          <div class="form-check">
                            <input class="form-check-input" id="duration24" name="loanDuration" type="radio" value="24" />
                            <label class="form-check-label" for="duration24">24 months</label>
                          </div>
                        </div>
                        <div class="col-md-2 col-6">
                          <div class="form-check">
                            <input class="form-check-input" id="duration36" name="loanDuration" type="radio" value="36" />
                            <label class="form-check-label" for="duration36">36 months</label>
                          </div>
                        </div>
                        <div class="col-md-2 col-6">
                          <div class="form-check">
                            <input class="form-check-input" id="duration48" name="loanDuration" type="radio" value="48" />
                            <label class="form-check-label" for="duration48">48 months</label>
                          </div>
                        </div>
                        <div class="col-md-2 col-6">
                          <div class="form-check">
                            <input class="form-check-input" id="duration60" name="loanDuration" type="radio" value="60" />
                            <label class="form-check-label" for="duration60">60 months</label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Loan Type Specific Fields -->
                  <div id="loanSpecificFields" style="display: none;">
                    <hr class="my-4">
                    
                    <!-- Personal Loan Specific -->
                    <div id="personalLoanFields" class="loan-specific-section" style="display: none;">
                      <h5 class="mb-3">Personal Loan Details</h5>
                      <div class="row gy-4">
                        <div class="col-md-6">
                          <label class="label" for="personalLoanReason">Reason for Personal Loan</label>
                          <div class="custom-dropdown" data-name="personalLoanReason">
                            <div class="custom-dropdown-selected placeholder" tabindex="0">
                              <span>Select reason</span>
                              <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                            </div>
                            <div class="custom-dropdown-options">
                              <div class="custom-dropdown-option" data-value="debt-consolidation">Debt Consolidation</div>
                              <div class="custom-dropdown-option" data-value="home-improvement">Home Improvement</div>
                              <div class="custom-dropdown-option" data-value="medical-expenses">Medical Expenses</div>
                              <div class="custom-dropdown-option" data-value="vacation">Vacation/Travel</div>
                              <div class="custom-dropdown-option" data-value="wedding">Wedding</div>
                              <div class="custom-dropdown-option" data-value="education">Education</div>
                              <div class="custom-dropdown-option" data-value="other">Other</div>
                            </div>
                          </div>
                          <input type="hidden" id="personalLoanReason" name="personalLoanReason" />
                        </div>
                        <div class="col-md-6">
                          <label class="label" for="personalLoanUnsecured">Loan Type</label>
                          <div class="custom-dropdown" data-name="personalLoanUnsecured">
                            <div class="custom-dropdown-selected" tabindex="0">
                              <span>Unsecured Personal Loan</span>
                              <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                            </div>
                            <div class="custom-dropdown-options">
                              <div class="custom-dropdown-option selected" data-value="unsecured">Unsecured Personal Loan</div>
                              <div class="custom-dropdown-option" data-value="secured">Secured Personal Loan</div>
                            </div>
                          </div>
                          <input type="hidden" id="personalLoanUnsecured" name="personalLoanUnsecured" value="unsecured" />
                        </div>
                      </div>
                    </div>

                    <!-- Home Loan Specific -->
                    <div id="homeLoanFields" class="loan-specific-section" style="display: none;">
                      <h5 class="mb-3">Home Loan Details</h5>
                      <div class="row gy-4">
                        <div class="col-md-6">
                          <label class="label required-field" for="propertyType">Property Type</label>
                          <div class="custom-dropdown" data-name="propertyType" data-required="true">
                            <div class="custom-dropdown-selected placeholder" tabindex="0">
                              <span>Select property type</span>
                              <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                            </div>
                            <div class="custom-dropdown-options">
                              <div class="custom-dropdown-option" data-value="single-family">Single Family Home</div>
                              <div class="custom-dropdown-option" data-value="condo">Condominium</div>
                              <div class="custom-dropdown-option" data-value="townhouse">Townhouse</div>
                              <div class="custom-dropdown-option" data-value="multi-family">Multi-Family</div>
                            </div>
                          </div>
                          <input type="hidden" id="propertyType" name="propertyType" />
                        </div>
                        <div class="col-md-6">
                          <label class="label required-field" for="propertyValue">Estimated Property Value</label>
                          <div class="input-field">
                            <span>$</span>
                            <input class="form-control" id="propertyValue" name="propertyValue" type="number" min="50000" />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="label required-field" for="downPayment">Down Payment Amount</label>
                          <div class="input-field">
                            <span>$</span>
                            <input class="form-control" id="downPayment" name="downPayment" type="number" min="0" />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="label required-field" for="propertyUse">Property Use</label>
                          <div class="custom-dropdown" data-name="propertyUse" data-required="true">
                            <div class="custom-dropdown-selected placeholder" tabindex="0">
                              <span>Select use</span>
                              <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                            </div>
                            <div class="custom-dropdown-options">
                              <div class="custom-dropdown-option" data-value="primary">Primary Residence</div>
                              <div class="custom-dropdown-option" data-value="secondary">Secondary/Vacation Home</div>
                              <div class="custom-dropdown-option" data-value="investment">Investment Property</div>
                            </div>
                          </div>
                          <input type="hidden" id="propertyUse" name="propertyUse" />
                        </div>
                      </div>
                    </div>

                    <!-- Business Loan Specific -->
                    <div id="businessLoanFields" class="loan-specific-section" style="display: none;">
                      <h5 class="mb-3">Business Loan Details</h5>
                      <div class="row gy-4">
                        <div class="col-md-6">
                          <label class="label required-field" for="businessName">Business Name</label>
                          <input class="form-control" id="businessName" name="businessName" type="text" />
                        </div>
                        <div class="col-md-6">
                          <label class="label required-field" for="businessType">Business Type</label>
                          <div class="custom-dropdown" data-name="businessType" data-required="true">
                            <div class="custom-dropdown-selected placeholder" tabindex="0">
                              <span>Select business type</span>
                              <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                            </div>
                            <div class="custom-dropdown-options">
                              <div class="custom-dropdown-option" data-value="sole-proprietorship">Sole Proprietorship</div>
                              <div class="custom-dropdown-option" data-value="partnership">Partnership</div>
                              <div class="custom-dropdown-option" data-value="llc">LLC</div>
                              <div class="custom-dropdown-option" data-value="corporation">Corporation</div>
                            </div>
                          </div>
                          <input type="hidden" id="businessType" name="businessType" />
                        </div>
                        <div class="col-md-6">
                          <label class="label required-field" for="businessAge">Years in Business</label>
                          <div class="custom-dropdown" data-name="businessAge" data-required="true">
                            <div class="custom-dropdown-selected placeholder" tabindex="0">
                              <span>Select duration</span>
                              <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                            </div>
                            <div class="custom-dropdown-options">
                              <div class="custom-dropdown-option" data-value="less-than-1">Less than 1 year</div>
                              <div class="custom-dropdown-option" data-value="1-2">1-2 years</div>
                              <div class="custom-dropdown-option" data-value="3-5">3-5 years</div>
                              <div class="custom-dropdown-option" data-value="more-than-5">More than 5 years</div>
                            </div>
                          </div>
                          <input type="hidden" id="businessAge" name="businessAge" />
                        </div>
                        <div class="col-md-6">
                          <label class="label required-field" for="annualRevenue">Annual Business Revenue</label>
                          <div class="input-field">
                            <span>$</span>
                            <input class="form-control" id="annualRevenue" name="annualRevenue" type="number" min="0" />
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- Car Loan Specific -->
                    <div id="carLoanFields" class="loan-specific-section" style="display: none;">
                      <h5 class="mb-3">Car Loan Details</h5>
                      <div class="row gy-4">
                        <div class="col-md-6">
                          <label class="label required-field" for="vehicleType">Vehicle Type</label>
                          <div class="custom-dropdown" data-name="vehicleType" data-required="true">
                            <div class="custom-dropdown-selected placeholder" tabindex="0">
                              <span>Select vehicle type</span>
                              <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                            </div>
                            <div class="custom-dropdown-options">
                              <div class="custom-dropdown-option" data-value="new">New Vehicle</div>
                              <div class="custom-dropdown-option" data-value="used">Used Vehicle</div>
                              <div class="custom-dropdown-option" data-value="certified-pre-owned">Certified Pre-Owned</div>
                            </div>
                          </div>
                          <input type="hidden" id="vehicleType" name="vehicleType" />
                        </div>
                        <div class="col-md-6">
                          <label class="label required-field" for="vehiclePrice">Vehicle Price</label>
                          <div class="input-field">
                            <span>$</span>
                            <input class="form-control" id="vehiclePrice" name="vehiclePrice" type="number" min="5000" />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="label" for="vehicleMake">Vehicle Make</label>
                          <input class="form-control" id="vehicleMake" name="vehicleMake" type="text" placeholder="e.g., Toyota, Ford, BMW" />
                        </div>
                        <div class="col-md-6">
                          <label class="label" for="vehicleModel">Vehicle Model</label>
                          <input class="form-control" id="vehicleModel" name="vehicleModel" type="text" placeholder="e.g., Camry, F-150, X3" />
                        </div>
                        <div class="col-md-6">
                          <label class="label" for="vehicleYear">Vehicle Year</label>
                          <input class="form-control" id="vehicleYear" name="vehicleYear" type="number" min="2000" max="2025" />
                        </div>
                        <div class="col-md-6">
                          <label class="label" for="tradeInValue">Trade-in Value (if applicable)</label>
                          <div class="input-field">
                            <span>$</span>
                            <input class="form-control" id="tradeInValue" name="tradeInValue" type="number" min="0" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Step 2: Personal & Address Information -->
                <div class="form-step" id="step2">
                  <h3><i class="fas fa-user"></i> Personal & Address Information</h3>
                  
                  <!-- Personal Information -->
                  <h5 class="mb-3">Personal Information</h5>
                  <div class="row gy-4 mb-4">
                    <div class="col-md-6">
                      <label class="label required-field" for="firstName">First Name</label>
                      <input class="form-control" id="firstName" name="firstName" type="text" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="lastName">Last Name</label>
                      <input class="form-control" id="lastName" name="lastName" type="text" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="dateOfBirth">Date of Birth</label>
                      <input class="form-control" id="dateOfBirth" name="dateOfBirth" type="date" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="email">Email Address</label>
                      <input class="form-control" id="email" name="email" type="email" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="phoneNumber">Phone Number</label>
                      <input class="form-control" id="phoneNumber" name="phoneNumber" type="tel" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="socialSecurityNumber">Social Security Number / National ID</label>
                      <input class="form-control" id="socialSecurityNumber" name="socialSecurityNumber" type="text" required />
                    </div>
                  </div>

                  <!-- Address Information -->
                  <hr class="my-4">
                  <h5 class="mb-3">Current Address</h5>
                  
                  <!-- Address Template Selector -->
                  <div class="address-template-selector">
                    <h6 class="mb-3"><i class="fas fa-map-marker-alt"></i> Address Selection</h6>
                    <div class="address-template-option">
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="addressType" id="templateAddress" value="template" checked>
                        <label class="form-check-label" for="templateAddress">
                          <strong>Select from Common Addresses</strong>
                        </label>
                      </div>
                      <div class="mt-2" id="templateSelector">
                        <div class="custom-dropdown" data-name="addressTemplate">
                          <div class="custom-dropdown-selected placeholder" tabindex="0">
                            <span>Choose a template address</span>
                            <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                          </div>
                          <div class="custom-dropdown-options">
                            <div class="custom-dropdown-option" data-value="london-downtown">
                              <strong>London Downtown</strong><br>
                              <small>123 Oxford Street, London, UK W1C 1JN</small>
                            </div>
                            <div class="custom-dropdown-option" data-value="london-residential">
                              <strong>London Residential</strong><br>
                              <small>456 Baker Street, London, UK NW1 6XE</small>
                            </div>
                            <div class="custom-dropdown-option" data-value="manchester-city">
                              <strong>Manchester City Centre</strong><br>
                              <small>789 Deansgate, Manchester, UK M3 2BW</small>
                            </div>
                            <div class="custom-dropdown-option" data-value="birmingham-central">
                              <strong>Birmingham Central</strong><br>
                              <small>321 Bull Street, Birmingham, UK B4 6AD</small>
                            </div>
                            <div class="custom-dropdown-option" data-value="edinburgh-royal">
                              <strong>Edinburgh Royal Mile</strong><br>
                              <small>654 Royal Mile, Edinburgh, UK EH1 1RE</small>
                            </div>
                          </div>
                        </div>
                        <div class="address-preview" id="addressPreview" style="display: none;">
                          <div id="previewContent"></div>
                        </div>
                      </div>
                    </div>
                    <div class="address-template-option">
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="addressType" id="manualAddress" value="manual">
                        <label class="form-check-label" for="manualAddress">
                          <strong>Enter Address Manually</strong>
                        </label>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Address Fields -->
                  <div class="address-fields template-selected" id="addressFields">
                    <div class="row gy-4">
                      <div class="col-md-8">
                        <label class="label required-field" for="currentAddress">Street Address</label>
                        <input class="form-control" id="currentAddress" name="currentAddress" type="text" required />
                      </div>
                      <div class="col-md-4">
                        <label class="label" for="currentAptUnit">Apt/Unit/Suite</label>
                        <input class="form-control" id="currentAptUnit" name="currentAptUnit" type="text" />
                      </div>
                      <div class="col-md-6">
                        <label class="label required-field" for="currentCity">City</label>
                        <input class="form-control" id="currentCity" name="currentCity" type="text" required />
                      </div>
                      <div class="col-md-3">
                        <label class="label required-field" for="currentState">State/Province</label>
                        <input class="form-control" id="currentState" name="currentState" type="text" required />
                      </div>
                      <div class="col-md-3">
                        <label class="label required-field" for="currentZipCode">ZIP/Postal Code</label>
                        <input class="form-control" id="currentZipCode" name="currentZipCode" type="text" required />
                      </div>
                      <div class="col-md-6">
                        <label class="label required-field" for="currentCountry">Country</label>
                        <div class="custom-dropdown" data-name="currentCountry" data-required="true">
                          <div class="custom-dropdown-selected placeholder" tabindex="0">
                            <span>Select country</span>
                            <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                          </div>
                          <div class="custom-dropdown-options">
                            <div class="custom-dropdown-option" data-value="US">United States</div>
                            <div class="custom-dropdown-option" data-value="UK">United Kingdom</div>
                            <div class="custom-dropdown-option" data-value="CA">Canada</div>
                            <div class="custom-dropdown-option" data-value="AU">Australia</div>
                            <div class="custom-dropdown-option" data-value="other">Other</div>
                          </div>
                        </div>
                        <input type="hidden" id="currentCountry" name="currentCountry" required />
                      </div>
                      <div class="col-md-6">
                        <label class="label required-field" for="housingStatus">Housing Status</label>
                        <div class="custom-dropdown" data-name="housingStatus" data-required="true">
                          <div class="custom-dropdown-selected placeholder" tabindex="0">
                            <span>Select status</span>
                            <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                          </div>
                          <div class="custom-dropdown-options">
                            <div class="custom-dropdown-option" data-value="own">Own</div>
                            <div class="custom-dropdown-option" data-value="rent">Rent</div>
                            <div class="custom-dropdown-option" data-value="mortgage">Mortgage</div>
                            <div class="custom-dropdown-option" data-value="live-with-family">Live with Family</div>
                          </div>
                        </div>
                        <input type="hidden" id="housingStatus" name="housingStatus" required />
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Step 3: Employment & Income Information -->
                <div class="form-step" id="step3">
                  <h3><i class="fas fa-briefcase"></i> Employment & Income Information</h3>
                  
                  <!-- Employment Information -->
                  <h5 class="mb-3">Employment Information</h5>
                  <div class="row gy-4 mb-4">
                    <div class="col-md-6">
                      <label class="label required-field" for="employmentStatus">Employment Status</label>
                      <div class="custom-dropdown" data-name="employmentStatus" data-required="true">
                        <div class="custom-dropdown-selected placeholder" tabindex="0">
                          <span>Select status</span>
                          <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                        </div>
                        <div class="custom-dropdown-options">
                          <div class="custom-dropdown-option" data-value="employed-full-time">Employed Full-Time</div>
                          <div class="custom-dropdown-option" data-value="employed-part-time">Employed Part-Time</div>
                          <div class="custom-dropdown-option" data-value="self-employed">Self-Employed</div>
                          <div class="custom-dropdown-option" data-value="retired">Retired</div>
                        </div>
                      </div>
                      <input type="hidden" id="employmentStatus" name="employmentStatus" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="occupation">Occupation</label>
                      <input class="form-control" id="occupation" name="occupation" type="text" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="employerName">Employer Name</label>
                      <input class="form-control" id="employerName" name="employerName" type="text" required />
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="annualIncome">Annual Gross Income</label>
                      <div class="input-field">
                        <span>$</span>
                        <input class="form-control" id="annualIncome" name="annualIncome" type="number" min="0" required />
                      </div>
                    </div>
                  </div>

                  <!-- Financial Information -->
                  <hr class="my-4">
                  <h5 class="mb-3">Financial Information</h5>
                  <div class="row gy-4">
                    <div class="col-md-6">
                      <label class="label" for="creditScore">Credit Score (if known)</label>
                      <div class="custom-dropdown" data-name="creditScore">
                        <div class="custom-dropdown-selected placeholder" tabindex="0">
                          <span>Select range</span>
                          <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                        </div>
                        <div class="custom-dropdown-options">
                          <div class="custom-dropdown-option" data-value="excellent">Excellent (750+)</div>
                          <div class="custom-dropdown-option" data-value="good">Good (650-749)</div>
                          <div class="custom-dropdown-option" data-value="fair">Fair (550-649)</div>
                          <div class="custom-dropdown-option" data-value="poor">Poor (below 550)</div>
                          <div class="custom-dropdown-option" data-value="unknown">Don't know</div>
                        </div>
                      </div>
                      <input type="hidden" id="creditScore" name="creditScore" />
                    </div>
                    <div class="col-md-6">
                      <label class="label" for="existingDebts">Total Existing Debt</label>
                      <div class="input-field">
                        <span>$</span>
                        <input class="form-control" id="existingDebts" name="existingDebts" type="number" min="0" />
                      </div>
                    </div>
                    <div class="col-md-6">
                      <label class="label required-field" for="monthlyExpenses">Total Monthly Expenses</label>
                      <div class="input-field">
                        <span>$</span>
                        <input class="form-control" id="monthlyExpenses" name="monthlyExpenses" type="number" min="0" required />
                      </div>
                    </div>
                    <div class="col-md-6">
                      <label class="label" for="bankruptcyHistory">Bankruptcy History</label>
                      <div class="custom-dropdown" data-name="bankruptcyHistory">
                        <div class="custom-dropdown-selected" tabindex="0">
                          <span>Never</span>
                          <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                        </div>
                        <div class="custom-dropdown-options">
                          <div class="custom-dropdown-option selected" data-value="never">Never</div>
                          <div class="custom-dropdown-option" data-value="within-7-years">Within last 7 years</div>
                          <div class="custom-dropdown-option" data-value="over-7-years">Over 7 years ago</div>
                        </div>
                      </div>
                      <input type="hidden" id="bankruptcyHistory" name="bankruptcyHistory" value="never" />
                    </div>
                  </div>
                </div>

                <!-- Step 4: Document Upload -->
                <div class="form-step" id="step4">
                  <h3><i class="fas fa-upload"></i> Document Upload - KYC Verification</h3>
                  
                  <div class="kyc-notice mb-4">
                    <h5><i class="fas fa-info-circle"></i> Required Documents for KYC Compliance</h5>
                    <ul class="mb-0">
                      <li>Government-issued photo ID (passport, driver's license, or national ID)</li>
                      <li>Proof of address (utility bill, bank statement, or lease agreement)</li>
                      <li>Proof of income (pay stubs, tax returns, or employment letter)</li>
                    </ul>
                  </div>

                  <div class="row gy-4">
                    <!-- Identity Document -->
                    <div class="col-md-6">
                      <label class="label required-field">Government ID</label>
                      <div class="file-upload-area" data-upload-type="id-document">
                        <i class="fas fa-cloud-upload-alt fa-2x mb-3"></i>
                        <p>Upload government-issued ID</p>
                        <small class="text-muted">Accepted formats: JPG, PNG, PDF (Max 5MB)</small>
                        <input type="file" id="idDocument" name="idDocument" accept=".jpg,.jpeg,.png,.pdf" style="display: none;" required />
                      </div>
                      <div class="uploaded-files" id="idDocumentFiles"></div>
                    </div>

                    <!-- Proof of Address -->
                    <div class="col-md-6">
                      <label class="label required-field">Proof of Address</label>
                      <div class="file-upload-area" data-upload-type="address-proof">
                        <i class="fas fa-home fa-2x mb-3"></i>
                        <p>Upload utility bill or bank statement</p>
                        <small class="text-muted">Document must be dated within 90 days</small>
                        <input type="file" id="addressProof" name="addressProof" accept=".jpg,.jpeg,.png,.pdf" style="display: none;" required />
                      </div>
                      <div class="uploaded-files" id="addressProofFiles"></div>
                    </div>

                    <!-- Proof of Income -->
                    <div class="col-md-6">
                      <label class="label required-field">Proof of Income</label>
                      <div class="file-upload-area" data-upload-type="income-proof">
                        <i class="fas fa-money-bill-wave fa-2x mb-3"></i>
                        <p>Upload pay stubs or employment letter</p>
                        <small class="text-muted">Most recent documents preferred</small>
                        <input type="file" id="incomeProof" name="incomeProof" accept=".jpg,.jpeg,.png,.pdf" style="display: none;" required />
                      </div>
                      <div class="uploaded-files" id="incomeProofFiles"></div>
                    </div>
                  </div>
                </div>

                <!-- Step 5: Review & Submit -->
                <div class="form-step" id="step5">
                  <h3><i class="fas fa-file-contract"></i> Review & Submit Application</h3>
                  
                  <!-- KYC Compliance Questions -->
                  <div class="risk-assessment mb-4">
                    <h5><i class="fas fa-shield-alt"></i> Compliance Questions</h5>
                    <p>Please answer these questions for regulatory compliance:</p>
                  </div>

                  <div class="row gy-4 mb-4">
                    <div class="col-12">
                      <label class="label required-field">Are you a Politically Exposed Person (PEP)?</label>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="pepStatus" id="pepNo" value="no" required>
                        <label class="form-check-label" for="pepNo">No</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="pepStatus" id="pepYes" value="yes">
                        <label class="form-check-label" for="pepYes">Yes</label>
                      </div>
                      <small class="text-muted">PEP includes government officials or their close associates</small>
                    </div>

                    <div class="col-12">
                      <label class="label required-field">Source of funds for this loan:</label>
                      <div class="custom-dropdown" data-name="sourceOfFunds" data-required="true">
                        <div class="custom-dropdown-selected placeholder" tabindex="0">
                          <span>Select source</span>
                          <i class="fas fa-chevron-down custom-dropdown-arrow"></i>
                        </div>
                        <div class="custom-dropdown-options">
                          <div class="custom-dropdown-option" data-value="salary">Salary/Employment Income</div>
                          <div class="custom-dropdown-option" data-value="business">Business Income</div>
                          <div class="custom-dropdown-option" data-value="savings">Personal Savings</div>
                          <div class="custom-dropdown-option" data-value="other">Other</div>
                        </div>
                      </div>
                      <input type="hidden" name="sourceOfFunds" required />
                    </div>
                  </div>

                  <!-- Terms and Conditions -->
                  <hr class="my-4">
                  <div class="kyc-notice">
                    <h5><i class="fas fa-info-circle"></i> Terms and Conditions</h5>
                    <div style="max-height: 200px; overflow-y: auto; padding: 10px; background: white; border: 1px solid #dee2e6;">
                      <h6>Data Protection and Privacy</h6>
                      <p>By submitting this application, you consent to the collection, processing, and storage of your personal data.</p>
                      
                      <h6>Credit Checks</h6>
                      <p>We will perform credit checks which may affect your credit score to assess your creditworthiness.</p>
                      
                      <h6>Loan Terms</h6>
                      <p>Final loan terms including interest rates and fees will be provided upon approval.</p>
                    </div>
                  </div>

                  <div class="row gy-4 mt-4">
                    <div class="col-12">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="agreeTerms" name="agreeTerms" required>
                        <label class="form-check-label required-field" for="agreeTerms">
                          I agree to the Terms and Conditions and consent to credit checks and data processing.
                        </label>
                      </div>
                    </div>

                    <div class="col-12">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="confirmAccuracy" name="confirmAccuracy" required>
                        <label class="form-check-label required-field" for="confirmAccuracy">
                          I confirm that all information provided is true and accurate.
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Digital Signature -->
                  <div class="row gy-4 mt-4">
                    <div class="col-12">
                      <label class="label required-field">Digital Signature</label>
                      <div class="signature-options mb-3">
                        <div class="btn-group" role="group">
                          <input type="radio" class="btn-check" name="signatureMethod" id="typeSignature" value="type" checked>
                          <label class="btn btn-outline-primary" for="typeSignature">
                            <i class="fas fa-keyboard"></i> Type Signature
                          </label>
                          <input type="radio" class="btn-check" name="signatureMethod" id="drawSignature" value="draw">
                          <label class="btn btn-outline-primary" for="drawSignature">
                            <i class="fas fa-pen"></i> Draw Signature
                          </label>
                        </div>
                      </div>
                      
                      <!-- Type Signature -->
                      <div id="typeSignatureSection" class="signature-section">
                        <div class="row">
                          <div class="col-md-8">
                            <input class="form-control" id="digitalSignature" name="digitalSignature" type="text" placeholder="Type your full name" required />
                            <small class="text-muted">By typing your name, you are providing your digital signature</small>
                          </div>
                          <div class="col-md-4">
                            <label class="label required-field" for="signatureDate">Date</label>
                            <input class="form-control" id="signatureDate" name="signatureDate" type="date" required readonly />
                          </div>
                        </div>
                      </div>
                      
                      <!-- Draw Signature -->
                      <div id="drawSignatureSection" class="signature-section" style="display: none;">
                        <div class="signature-pad-container">
                          <div class="signature-pad-header d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">Please sign in the box below:</span>
                            <a href="#" class="btn btn-sm btn-outline-secondary" id="clearSignature">
                              <i class="fas fa-eraser"></i> Clear
                            </a>
                          </div>
                          <div class="canvas-container">
                            <canvas id="signaturePad"></canvas>
                          </div>
                          <input type="hidden" id="signatureData" name="signatureData" />
                          <div class="row mt-3">
                            <div class="col-md-4">
                              <label class="label required-field" for="signatureDateDraw">Date</label>
                              <input class="form-control" id="signatureDateDraw" name="signatureDateDraw" type="date" required readonly />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Navigation Buttons - Only show for the active step -->
                <div class="nav-buttons">
                  <div class="row mt-60">
                    <div class="col-md-12">
                      <div class="nav-btn d-flex justify-content-between">
                        <button type="button" class="prev-btn theme-btn-primary_alt theme-btn" onclick="prevStep()" style="display: none;">
                          <i class="arrow_left"></i>previous
                        </button>
                        <button type="button" class="next-btn theme-btn-primary_alt theme-btn" onclick="nextStep()">
                          next<i class="arrow_right"></i>
                        </button>
                        <button type="button" id="submitApplication" class="theme-btn theme-btn-lg" style="display: none;">
                          <span class="spinner-border spinner-border-sm me-2" style="display: none;"></span>
                          Submit Application
                        </button>
                      </div>
                      <div class="mt-3 text-center">
                        <small class="text-muted">Application processing typically takes 1-3 business days</small>
                      </div>
                    </div>
                  </div>
                </div>

              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- footer -->
  <footer class="footer footer-3">
    <div class="footer-top pt-200 pb-lg-115 pb-120">
      <div class="container">
        <div class="row gx-0 pt-45">
          <div class="col-lg-4 col-sm-6 text-center text-sm-start ms-0">
            <div class="footer-widget wow fadeInLeft mb-30">
              <div class="footer-text mb-20">
                <p>Whatfix Bank is a demo platform designed for training and demonstration purposes only. Experience our digital banking solutions in a safe, simulated environment.</p>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-sm-6 text-center text-sm-start ms-lg-5">
            <div class="footer-widget mb-30 wow fadeInUp" data-wow-delay="0.1s">
              <div class="f-widget-title">
                <h5>About Whatfix Bank</h5>
              </div>
              <div class="footer-link">
                <ul>
                  <li><a href="index.html">Our Services</a></li>
                  <li><a href="contact.html">Company Purpose</a></li>
                  <li><a href="job-application.html">Careers</a></li>
                  <li><a href="contact.html">Corporate Responsibility</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-sm-6 text-center text-sm-start ms-lg-5">
            <div class="footer-widget mb-30 wow fadeInUp" data-wow-delay="0.3s">
              <div class="f-widget-title">
                <h5>Resources</h5>
              </div>
              <div class="footer-link">
                <ul>
                  <li><a href="contact.html">Help Center</a></li>
                  <li><a href="index.html#security">Security Information</a></li>
                  <li><a href="index.html#faq">FAQ</a></li>
                  <li><a href="contact.html">Contact Support</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-sm-6 text-center text-sm-start me-0 ms-lg-5">
            <div class="footer-widget mb-30 wow fadeInUp" data-wow-delay="0.5s">
              <div class="f-widget-title">
                <h5>Quick Links</h5>
              </div>
              <div class="footer-link">
                <ul>
                  <li><a href="login.html">Login</a></li>
                  <li><a href="comprehensive-loan-application.html">Apply for Loan</a></li>
                  <li><a href="onlinebanking-home.html">Open Account</a></li>
                  <li><a href="contact.html">Find Branch</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- copyright area -->
    <div class="copyright pt-25 pb-25">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-5 text-center my-3 my-sm-0">
            <div class="copyright-text">
              <p>Made with ❤️ by <a href="https://whatfix.com" target="_blank">Whatfix BFSI Team</a> | Copyright © Whatfix 2025</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- footer end -->

  <!-- Back to top button -->
  <a id="back-to-top" title="Back to Top"></a>

  <!-- JS here -->
  <script src="js/jquery-3.6.0.min.js" type="text/javascript"></script>
  <script src="js/bootstrap.bundle.min.js" type="text/javascript"></script>
  <script src="js/jquery.smoothscroll.min.js" type="text/javascript"></script>
  <script src="js/jquery.waypoints.min.js" type="text/javascript"></script>
  <script src="js/jquery.counterup.min.js" type="text/javascript"></script>
  <script src="js/jquery.nice-select.min.js" type="text/javascript"></script>
  <script src="js/dropzone.min.js" type="text/javascript"></script>
  <script src="js/wow.min.js" type="text/javascript"></script>
  <script src="js/custom.js" type="text/javascript"></script>
  <!-- Signature Pad Library -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>

  <script>
    // Step navigation functionality
    let currentStep = 1;
    const totalSteps = 5;

    function showStep(step) {
      // Hide all steps
      for (let i = 1; i <= totalSteps; i++) {
        $('#step' + i).hide().removeClass('active');
        $('#step' + i + '-nav').removeClass('active complete');
      }
      
      // Show current step
      $('#step' + step).show().addClass('active');
      $('#step' + step + '-nav').addClass('active');
      
      // Mark previous steps as complete
      for (let i = 1; i < step; i++) {
        $('#step' + i + '-nav').addClass('complete');
      }
      
      currentStep = step;
      updateProgress();
      updateNavigationButtons();
    }

    function nextStep() {
      if (currentStep < totalSteps) {
        showStep(currentStep + 1);
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    function updateNavigationButtons() {
      const prevBtn = $('.prev-btn');
      const nextBtn = $('.next-btn');
      const submitBtn = $('#submitApplication');

      // Show/hide previous button
      if (currentStep === 1) {
        prevBtn.hide();
      } else {
        prevBtn.show();
      }

      // Show/hide next and submit buttons
      if (currentStep === totalSteps) {
        nextBtn.hide();
        submitBtn.show();
      } else {
        nextBtn.show();
        submitBtn.hide();
      }
    }

    function validateCurrentStep() {
      const currentStepElement = $('#step' + currentStep);
      const requiredFields = currentStepElement.find('[required]');
      let missingFields = [];

      requiredFields.each(function() {
        const field = $(this);
        const fieldName = field.closest('.col-md-6, .col-md-3, .col-md-4, .col-md-8, .col-12').find('label').text().replace('*', '').trim();
        
        if (field.is(':radio')) {
          const radioGroup = currentStepElement.find(`input[name="${field.attr('name')}"]`);
          if (!radioGroup.is(':checked')) {
            missingFields.push(fieldName || field.attr('name'));
            field.addClass('is-invalid');
          } else {
            field.removeClass('is-invalid');
          }
        } else if (!field.val() || field.val().trim() === '') {
          missingFields.push(fieldName || field.attr('name'));
          field.addClass('is-invalid');
        } else {
          field.removeClass('is-invalid').addClass('is-valid');
        }
      });

      // Show warning but allow proceeding
      if (missingFields.length > 0) {
        const message = `The following fields are recommended: ${missingFields.join(', ')}. You can continue, but completing these fields will improve your application.`;
        showErrorMessage(message, 'warning');
        
        // Auto-hide warning after 5 seconds
        setTimeout(() => {
          hideErrorMessage();
        }, 5000);
      } else {
        hideErrorMessage();
      }
      
      return true; // Always allow proceeding
    }

    function updateProgress() {
      const progress = (currentStep / totalSteps) * 100;
      $('#progressBar').css('width', progress + '%');
      $('#progressText').text(Math.round(progress) + '%');
      $('#currentStepText').text(currentStep);
    }

          // Custom dropdown functionality
      function initCustomDropdowns() {
        // Remove existing event handlers to prevent duplicates
        $('.custom-dropdown').off('click keydown');
        $('.custom-dropdown .custom-dropdown-option').off('click');
        
        $('.custom-dropdown').each(function() {
          const dropdown = $(this);
          const selected = dropdown.find('.custom-dropdown-selected');
          const options = dropdown.find('.custom-dropdown-options');
          let hiddenInput = dropdown.siblings('input[type="hidden"]');
          
          // If no sibling hidden input, look for one in parent or create one
          if (hiddenInput.length === 0) {
            hiddenInput = dropdown.parent().find('input[type="hidden"]');
          }
          if (hiddenInput.length === 0) {
            const name = dropdown.data('name');
            const isRequired = dropdown.data('required') === true || dropdown.data('required') === 'true';
            hiddenInput = $(`<input type="hidden" name="${name}" ${isRequired ? 'required' : ''} />`);
            dropdown.after(hiddenInput);
          }
          
          const name = dropdown.data('name');
          
          // Set initial value if already selected
          const initialOption = dropdown.find('.custom-dropdown-option.selected');
          if (initialOption.length) {
            const value = initialOption.data('value');
            const text = initialOption.text();
            selected.find('span').text(text);
            selected.removeClass('placeholder');
            hiddenInput.val(value);
          }
          
          // Toggle dropdown
          selected.on('click.customDropdown', function(e) {
            e.preventDefault();
            e.stopPropagation();
            // Close other dropdowns
            $('.custom-dropdown').not(dropdown).removeClass('open');
            dropdown.toggleClass('open');
          });
          
          // Select option
          dropdown.find('.custom-dropdown-option').on('click.customDropdown', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const option = $(this);
            const value = option.data('value');
            const text = option.text(); // Use text() instead of html() to avoid HTML issues
            
            // Update selected display
            selected.find('span').text(text);
            selected.removeClass('placeholder');
            
            // Update hidden input
            hiddenInput.val(value);
            
            // Update selected option
            dropdown.find('.custom-dropdown-option').removeClass('selected');
            option.addClass('selected');
            
            // Close dropdown
            dropdown.removeClass('open');
            
            // Trigger change event for validation
            hiddenInput.trigger('change');
            
            // Debug log
            console.log(`Dropdown ${name} selected: ${value} = ${text}`);
          });
          
          // Keyboard navigation
          selected.on('keydown.customDropdown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              selected.trigger('click.customDropdown');
            }
          });
        });
        
        // Close dropdowns when clicking outside (remove previous handler first)
        $(document).off('click.customDropdown').on('click.customDropdown', function(e) {
          if (!$(e.target).closest('.custom-dropdown').length) {
            $('.custom-dropdown').removeClass('open');
          }
        });
      }
      
      // Address template functionality
      function initAddressTemplates() {
        const addressTemplates = {
          'london-downtown': {
            street: '123 Oxford Street',
            city: 'London',
            state: 'England',
            zip: 'W1C 1JN',
            country: 'UK'
          },
          'london-residential': {
            street: '456 Baker Street',
            city: 'London', 
            state: 'England',
            zip: 'NW1 6XE',
            country: 'UK'
          },
          'manchester-city': {
            street: '789 Deansgate',
            city: 'Manchester',
            state: 'England', 
            zip: 'M3 2BW',
            country: 'UK'
          },
          'birmingham-central': {
            street: '321 Bull Street',
            city: 'Birmingham',
            state: 'England',
            zip: 'B4 6AD', 
            country: 'UK'
          },
          'edinburgh-royal': {
            street: '654 Royal Mile',
            city: 'Edinburgh',
            state: 'Scotland',
            zip: 'EH1 1RE',
            country: 'UK'
          }
        };
        
        // Handle address type selection 
        $('input[name="addressType"]').on('change', function() {
          const addressFields = $('#addressFields');
          if ($(this).val() === 'manual') {
            addressFields.removeClass('template-selected').addClass('manual-entry');
            $('#templateSelector').hide();
            $('#addressPreview').hide();
            // Clear template values
            clearAddressFields();
          } else {
            addressFields.removeClass('manual-entry').addClass('template-selected');
            $('#templateSelector').show();
          }
        });
        
        // Handle template selection - use document delegation to work with dynamically initialized dropdowns
        $(document).off('click.addressTemplate').on('click.addressTemplate', '[data-name="addressTemplate"] .custom-dropdown-option', function() {
          const templateKey = $(this).data('value');
          const template = addressTemplates[templateKey];
          
          if (template) {
            // Fill address fields
            $('#currentAddress').val(template.street);
            $('#currentCity').val(template.city);
            $('#currentState').val(template.state);
            $('#currentZipCode').val(template.zip);
            
            // Update country dropdown
            const countryDropdown = $('[data-name="currentCountry"]');
            const countryOption = countryDropdown.find(`[data-value="${template.country}"]`);
            if (countryOption.length) {
              // Trigger the custom dropdown selection
              countryOption.trigger('click.customDropdown');
            }
            
            // Show preview
            const previewContent = `
              <strong>Selected Address:</strong><br>
              ${template.street}<br>
              ${template.city}, ${template.state} ${template.zip}<br>
              ${template.country}
            `;
            $('#previewContent').html(previewContent);
            $('#addressPreview').show();
          }
        });
        
        function clearAddressFields() {
          $('#currentAddress').val('');
          $('#currentCity').val('');
          $('#currentState').val('');
          $('#currentZipCode').val('');
          $('#currentAptUnit').val('');
          
          // Reset country dropdown
          const countryDropdown = $('[data-name="currentCountry"]');
          countryDropdown.find('.custom-dropdown-selected').addClass('placeholder').find('span').text('Select country');
          countryDropdown.find('.custom-dropdown-option').removeClass('selected');
          countryDropdown.siblings('input[type="hidden"]').val('');
        }
      }

      // Enhanced form functionality
      $(document).ready(function() {
              // Set current date for signature
        const today = new Date().toISOString().split('T')[0];
        $('#signatureDate').val(today);
        $('#signatureDateDraw').val(today);

        // Initialize custom components
        try {
          initCustomDropdowns();
          initAddressTemplates();
          console.log('Custom dropdowns and address templates initialized successfully');
        } catch (error) {
          console.error('Error initializing custom components:', error);
        }

        // Initialize first step
        showStep(1);

      // Loan type change handler
      $('input[name="select-loan-type"]').on('change', function() {
        const selectedLoanType = $(this).attr('id');
        showLoanSpecificFields(selectedLoanType);
      });

      // Signature method change handler
      $('input[name="signatureMethod"]').on('change', function() {
        const method = $(this).val();
        if (method === 'type') {
          $('#typeSignatureSection').show();
          $('#drawSignatureSection').hide();
          $('#digitalSignature').prop('required', false);
          $('#signatureData').prop('required', false);
        } else {
          $('#typeSignatureSection').hide();
          $('#drawSignatureSection').show();
          $('#digitalSignature').prop('required', false);
          $('#signatureData').prop('required', false);
          
          // Reinitialize signature pad when switching to draw mode
          setTimeout(function() {
            if (signaturePad) {
              const canvas = document.getElementById('signaturePad');
              const container = canvas.parentElement;
              const rect = container.getBoundingClientRect();
              const ratio = Math.max(window.devicePixelRatio || 1, 1);
              
              // Ensure minimum dimensions
              const canvasWidth = Math.max(rect.width, 300);
              const canvasHeight = window.innerWidth <= 768 ? 150 : 200;
              
              // Properly resize canvas
              canvas.width = canvasWidth * ratio;
              canvas.height = canvasHeight * ratio;
              canvas.style.width = canvasWidth + 'px';
              canvas.style.height = canvasHeight + 'px';
              
              const ctx = canvas.getContext('2d');
              ctx.scale(ratio, ratio);
              
              signaturePad.clear();
            }
          }, 100);
        }
      });

      // Initialize signature pad
      initializeSignaturePad();

      // File upload functionality
      $('.file-upload-area').each(function() {
        const uploadArea = $(this);
        const fileInput = uploadArea.find('input[type="file"]');
        const filesContainer = uploadArea.siblings('.uploaded-files');

        uploadArea.on('click', function() {
          fileInput.click();
        });

        uploadArea.on('dragover', function(e) {
          e.preventDefault();
          $(this).addClass('dragover');
        });

        uploadArea.on('dragleave', function() {
          $(this).removeClass('dragover');
        });

        uploadArea.on('drop', function(e) {
          e.preventDefault();
          $(this).removeClass('dragover');
          const files = e.originalEvent.dataTransfer.files;
          handleFiles(files, fileInput, filesContainer);
        });

        fileInput.on('change', function() {
          handleFiles(this.files, fileInput, filesContainer);
        });
      });

      function handleFiles(files, fileInput, filesContainer) {
        Array.from(files).forEach(file => {
          if (file.size > 5 * 1024 * 1024) { // 5MB limit
            alert('File size must be less than 5MB');
            return;
          }

          const fileDiv = $(`
            <div class="uploaded-file">
              <div>
                <i class="fas fa-file"></i>
                <span>${file.name}</span>
                <small class="text-muted">(${(file.size / 1024 / 1024).toFixed(2)} MB)</small>
              </div>
              <button type="button" class="btn btn-sm btn-outline-danger remove-file">
                <i class="fas fa-times"></i>
              </button>
            </div>
          `);

          fileDiv.find('.remove-file').on('click', function() {
            fileDiv.remove();
            fileInput.val(''); // Clear the input
          });

          filesContainer.append(fileDiv);
        });
      }

      // Form submission with retry logic
      let submissionAttempted = false; // Track if submission has been attempted before
      
      $('#submitApplication').on('click', function() {
        const submitBtn = $(this);
        const spinner = submitBtn.find('.spinner-border');

        // Show loading state
        submitBtn.prop('disabled', true);
        spinner.show();
        submitBtn.html('<span class="spinner-border spinner-border-sm me-2"></span>Processing Application...');

        // Simulate processing time
        setTimeout(function() {
          if (!submissionAttempted) {
            // First attempt - show error message
            submissionAttempted = true;
            
            showErrorMessage(
              'We\'re sorry, but we\'re unable to process your loan application at this time using our standard eCheck system. This is likely to occour due to document verification issues. Please try again later or wait for our team to reach out to you.',
              'error'
            );
            
            // Reset button state
            submitBtn.prop('disabled', false);
            spinner.hide();
            submitBtn.html('Submit Application');
            
            // Scroll to error message
            $('html, body').animate({
              scrollTop: $('.error-message').offset().top - 100
            }, 500);
          } else {
            // Second attempt - process successfully
            hideErrorMessage();
            
            // Show success message
            showErrorMessage(
              '<i class="fas fa-check-circle"></i> Congratulations! Your loan application has been submitted successfully. You will receive a confirmation email shortly and our team will review your application within 1-3 business days.',
              'success'
            );
            
            // Keep the processing state and redirect after showing success
            submitBtn.html('<span class="spinner-border spinner-border-sm me-2"></span>Application Submitted Successfully!');
            
            // Scroll to success message
            $('html, body').animate({
              scrollTop: $('.error-message').offset().top - 100
            }, 500);
            
            // Redirect after 3 seconds
            setTimeout(function() {
              window.location.href = 'loan-application-success.html';
            }, 3000);
          }
        }, 3000);
      });

      // Step navigation enhancements
      $('input[required], select[required]').on('change', function() {
        $(this).removeClass('is-invalid');
      });

      // Optional field highlighting (non-blocking)
      $('input, select').on('blur', function() {
        const field = $(this);
        if (field.val() && field.val().trim() !== '') {
          field.removeClass('is-invalid').addClass('is-valid');
        }
      });

      // Age validation for date of birth
      $('#dateOfBirth').on('change', function() {
        const dob = new Date($(this).val());
        const today = new Date();
        const age = today.getFullYear() - dob.getFullYear();
        const monthDiff = today.getMonth() - dob.getMonth();

        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
          age--;
        }

        if (age < 18) {
          alert('You must be at least 18 years old to apply for a loan.');
          $(this).val('');
        } else if (age > 100) {
          alert('Please enter a valid date of birth.');
          $(this).val('');
        }
      });

      // Income vs Loan Amount validation
      $('#loanAmount, #annualIncome').on('change', function() {
        const loanAmount = parseFloat($('#loanAmount').val()) || 0;
        const annualIncome = parseFloat($('#annualIncome').val()) || 0;

        if (loanAmount > 0 && annualIncome > 0) {
          const debtToIncomeRatio = (loanAmount / annualIncome) * 100;
          
          if (debtToIncomeRatio > 40) {
            alert('Warning: Your requested loan amount exceeds 40% of your annual income. This may affect approval chances.');
          }
        }
      });

      // Loan type specific fields handler
      function showLoanSpecificFields(loanType) {
        // Hide all loan specific sections
        $('.loan-specific-section').hide();
        
        // Show the container
        $('#loanSpecificFields').show();
        
        let targetSection = null;
        
        // Show specific section based on loan type
        switch(loanType) {
          case 'Personal_loan':
            targetSection = $('#personalLoanFields');
            targetSection.show();
            break;
          case 'Home_loan':
            targetSection = $('#homeLoanFields');
            targetSection.show();
            // Make home loan fields required
            $('#propertyType, #propertyValue, #downPayment, #propertyUse').prop('required', true);
            break;
          case 'Business_loan':
            targetSection = $('#businessLoanFields');
            targetSection.show();
            // Make business loan fields required
            $('#businessName, #businessType, #businessAge, #annualRevenue').prop('required', true);
            break;
          case 'Car_loan':
            targetSection = $('#carLoanFields');
            targetSection.show();
            // Make car loan fields required
            $('#vehicleType, #vehiclePrice').prop('required', true);
            break;
        }
        
        // Initialize dropdowns specifically for the newly shown section
        if (targetSection && targetSection.length) {
          setTimeout(() => {
            console.log('Initializing dropdowns for section:', targetSection.attr('id'));
            
            // Initialize only dropdowns in the target section
            targetSection.find('.custom-dropdown').each(function() {
              const dropdown = $(this);
              const selected = dropdown.find('.custom-dropdown-selected');
              const options = dropdown.find('.custom-dropdown-options');
              let hiddenInput = dropdown.siblings('input[type="hidden"]');
              
              // If no sibling hidden input, look for one in parent or create one
              if (hiddenInput.length === 0) {
                hiddenInput = dropdown.parent().find('input[type="hidden"]');
              }
              if (hiddenInput.length === 0) {
                const name = dropdown.data('name');
                const isRequired = dropdown.data('required') === true || dropdown.data('required') === 'true';
                hiddenInput = $(`<input type="hidden" name="${name}" ${isRequired ? 'required' : ''} />`);
                dropdown.after(hiddenInput);
              }
              
              const name = dropdown.data('name');
              
              // Remove existing handlers for this specific dropdown
              selected.off('click.customDropdown keydown.customDropdown');
              dropdown.find('.custom-dropdown-option').off('click.customDropdown');
              
              // Set initial value if already selected
              const initialOption = dropdown.find('.custom-dropdown-option.selected');
              if (initialOption.length) {
                const value = initialOption.data('value');
                const text = initialOption.text();
                selected.find('span').text(text);
                selected.removeClass('placeholder');
                hiddenInput.val(value);
              }
              
              // Toggle dropdown
              selected.on('click.customDropdown', function(e) {
                e.preventDefault();
                e.stopPropagation();
                // Close other dropdowns
                $('.custom-dropdown').not(dropdown).removeClass('open');
                dropdown.toggleClass('open');
                console.log('Clicked dropdown:', name, 'isOpen:', dropdown.hasClass('open'));
              });
              
              // Select option
              dropdown.find('.custom-dropdown-option').on('click.customDropdown', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const option = $(this);
                const value = option.data('value');
                const text = option.text();
                
                // Update selected display
                selected.find('span').text(text);
                selected.removeClass('placeholder');
                
                // Update hidden input
                hiddenInput.val(value);
                
                // Update selected option
                dropdown.find('.custom-dropdown-option').removeClass('selected');
                option.addClass('selected');
                
                // Close dropdown
                dropdown.removeClass('open');
                
                // Trigger change event for validation
                hiddenInput.trigger('change');
                
                console.log(`Dropdown ${name} selected: ${value} = ${text}`);
              });
              
              // Keyboard navigation
              selected.on('keydown.customDropdown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                  e.preventDefault();
                  selected.trigger('click.customDropdown');
                }
              });
              
              console.log('Initialized dropdown:', name, 'with', dropdown.find('.custom-dropdown-option').length, 'options');
            });
            
            console.log('Completed dropdown initialization for loan type:', loanType);
          }, 100);
        }
      }

      // Error message functions
      function showErrorMessage(message, type = 'error') {
        let errorDiv = $('.error-message');
        if (errorDiv.length === 0) {
          errorDiv = $('<div class="error-message"></div>');
          $('.nav-buttons').before(errorDiv);
        }
        
        // If message already contains an icon, use it as-is
        if (message.includes('<i class="fas fa-')) {
          errorDiv.removeClass('show').html(message);
        } else {
          errorDiv.removeClass('show').html(`
            <i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            ${message}
          `);
        }
        
        if (type === 'warning') {
          errorDiv.css({
            'background': '#fff3cd',
            'border-color': '#ffeaa7',
            'color': '#856404'
          });
        } else if (type === 'success') {
          errorDiv.css({
            'background': '#d4edda',
            'border-color': '#c3e6cb',
            'color': '#155724'
          });
        } else {
          errorDiv.css({
            'background': '#f8d7da',
            'border-color': '#f5c6cb',
            'color': '#721c24'
          });
        }
        
        errorDiv.addClass('show');
      }

      function hideErrorMessage() {
        $('.error-message').removeClass('show');
      }

      // Signature pad functionality using signature_pad library
      let signaturePad;

      function initializeSignaturePad() {
        const canvas = document.getElementById('signaturePad');
        if (!canvas) return;
        
        // Wait for container to be properly sized
        setTimeout(() => {
          // Set initial canvas size before initializing SignaturePad
          const container = canvas.parentElement;
          const rect = container.getBoundingClientRect();
          const ratio = Math.max(window.devicePixelRatio || 1, 1);
          
          // Ensure minimum dimensions
          const canvasWidth = Math.max(rect.width, 300);
          const canvasHeight = window.innerWidth <= 768 ? 150 : 200;
          
          canvas.width = canvasWidth * ratio;
          canvas.height = canvasHeight * ratio;
          canvas.style.width = canvasWidth + 'px';
          canvas.style.height = canvasHeight + 'px';
          
          const ctx = canvas.getContext('2d');
          ctx.scale(ratio, ratio);
          
          // Initialize signature pad with proper options
          signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'rgba(255, 255, 255, 1)',
            penColor: 'rgb(0, 0, 0)',
            velocityFilterWeight: 0.7,
            minWidth: 0.5,
            maxWidth: 2.5,
            throttle: 16,
            minDistance: 5
          });
          
          // Initial clear to ensure proper background
          signaturePad.clear();
          
          // Bind clear button after SignaturePad is initialized
          $('#clearSignature').off('click').on('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Clear button clicked (properly bound)'); // Debug log
            
            if (signaturePad && typeof signaturePad.clear === 'function') {
              signaturePad.clear();
              $('#signatureData').val('');
              console.log('Signature cleared successfully'); // Debug log
            } else {
              console.log('SignaturePad not available'); // Debug log
            }
            return false;
          });
          
          // Save signature data when drawing ends
          signaturePad.addEventListener('endStroke', function() {
            if (!signaturePad.isEmpty()) {
              $('#signatureData').val(signaturePad.toDataURL('image/png'));
            }
          });
          
          // Clear signature data when pad is cleared
          signaturePad.addEventListener('beginStroke', function() {
            hideErrorMessage(); // Hide any error messages when user starts signing
          });
          
        }, 100);
        
        // Resize canvas function
        function resizeCanvas() {
          if (!signaturePad) return;
          
          const container = canvas.parentElement;
          const rect = container.getBoundingClientRect();
          const ratio = Math.max(window.devicePixelRatio || 1, 1);
          
          // Save existing signature data
          const data = signaturePad.toData();
          
          // Ensure minimum dimensions
          const canvasWidth = Math.max(rect.width, 300);
          const canvasHeight = window.innerWidth <= 768 ? 150 : 200;
          
          // Resize canvas
          canvas.width = canvasWidth * ratio;
          canvas.height = canvasHeight * ratio;
          canvas.style.width = canvasWidth + 'px';
          canvas.style.height = canvasHeight + 'px';
          
          // Scale context
          const ctx = canvas.getContext('2d');
          ctx.scale(ratio, ratio);
          
          // Restore signature data
          signaturePad.fromData(data);
        }
        
        // Handle window resize with debounce
        let resizeTimeout;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimeout);
          resizeTimeout = setTimeout(resizeCanvas, 250);
        });
        

      }

      // Debug function to test dropdowns (can be called from browser console)
      window.debugDropdowns = function() {
        console.log('=== DROPDOWN DEBUG INFO ===');
        console.log('Total custom dropdowns found:', $('.custom-dropdown').length);
        
        $('.custom-dropdown').each(function(index) {
          const dropdown = $(this);
          const name = dropdown.data('name');
          const selected = dropdown.find('.custom-dropdown-selected');
          const options = dropdown.find('.custom-dropdown-option');
          const hiddenInput = dropdown.siblings('input[type="hidden"]').add(dropdown.parent().find('input[type="hidden"]'));
          
          console.log(`Dropdown ${index + 1}:`, {
            name: name,
            hasSelected: selected.length > 0,
            optionsCount: options.length,
            hasHiddenInput: hiddenInput.length > 0,
            hiddenInputValue: hiddenInput.val(),
            isVisible: dropdown.is(':visible'),
            element: dropdown[0]
          });
        });
        
        // Test click on first visible dropdown
        const firstDropdown = $('.custom-dropdown:visible').first();
        if (firstDropdown.length) {
          console.log('Testing first visible dropdown click...');
          firstDropdown.find('.custom-dropdown-selected').trigger('click');
        }
      };

      // Force reinitialize function
      window.forceReinitDropdowns = function() {
        console.log('Force reinitializing all dropdowns...');
        initCustomDropdowns();
        console.log('Reinitialization complete');
      };

      // Test specific loan type dropdowns
      window.testLoanDropdowns = function(loanType = 'Personal_loan') {
        console.log(`Testing ${loanType} dropdowns...`);
        
        // First select the loan type
        const loanRadio = $(`#${loanType}`);
        if (loanRadio.length) {
          loanRadio.prop('checked', true).trigger('change');
          console.log('Selected loan type:', loanType);
          
          // Wait for the section to show and dropdowns to initialize
          setTimeout(() => {
            const sectionMap = {
              'Personal_loan': '#personalLoanFields',
              'Business_loan': '#businessLoanFields',
              'Home_loan': '#homeLoanFields',
              'Car_loan': '#carLoanFields'
            };
            
            const section = $(sectionMap[loanType]);
            if (section.is(':visible')) {
              console.log('Section is visible, checking dropdowns...');
              const dropdowns = section.find('.custom-dropdown');
              console.log('Found', dropdowns.length, 'dropdowns in section');
              
              dropdowns.each(function(index) {
                const dropdown = $(this);
                const name = dropdown.data('name');
                const selected = dropdown.find('.custom-dropdown-selected');
                const options = dropdown.find('.custom-dropdown-option');
                
                console.log(`Dropdown ${index + 1} (${name}):`, {
                  hasClickHandler: selected.hasClass('has-click-handler'),
                  optionsCount: options.length,
                  isVisible: dropdown.is(':visible')
                });
                
                // Test click on first dropdown
                if (index === 0) {
                  console.log('Testing click on first dropdown...');
                  selected.trigger('click');
                }
              });
            } else {
              console.log('Section is not visible!');
            }
          }, 300);
        } else {
          console.log('Loan type radio button not found:', loanType);
        }
      };

    });
  </script>
</body>
</html> 